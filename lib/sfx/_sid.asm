	PROCESSOR 6502
	
V1FREQ	EQU $D400
V1PULS	EQU $D402
V1CTRL	EQU $D404
V1AD	EQU $D405
V1SR	EQU $D406

V2FREQ	EQU $D407
V2PULS	EQU $D409
V2CTRL	EQU $D40B
V2AD	EQU $D40C
V2SR	EQU $D40D

V3FREQ	EQU $D40E
V3PULS	EQU $D410
V3CTRL	EQU $D412
V3AD	EQU $D413
V3SR	EQU $D414                             

V4FREQ	EQU $D420
V4PULS	EQU $D422
V4CTRL	EQU $D424
V4AD	EQU $D425
V4SR	EQU $D426

V5FREQ	EQU $D427
V5PULS	EQU $D429
V5CTRL	EQU $D42B
V5AD	EQU $D42C
V5SR	EQU $D42D

V6FREQ	EQU $D42E
V6PULS	EQU $D430
V6CTRL	EQU $D432
V6AD	EQU $D433
V6SR	EQU $D434                             

V7FREQ	EQU $D440
V7PULS	EQU $D442
V7CTRL	EQU $D444
V7AD	EQU $D445
V7SR	EQU $D446

V8FREQ	EQU $D447
V8PULS	EQU $D449
V8CTRL	EQU $D44B
V8AD	EQU $D44C
V8SR	EQU $D44D

V9FREQ	EQU $D44E
V9PULS	EQU $D450
V9CTRL	EQU $D452
V9AD	EQU $D453
V9SR	EQU $D454                             

V10FREQ	EQU $D460
V10PULS	EQU $D462
V10CTRL	EQU $D464
V10AD	EQU $D465
V10SR	EQU $D466

V11FREQ	EQU $D467
V11PULS	EQU $D469
V11CTRL	EQU $D46B
V11AD	EQU $D46C
V11SR	EQU $D46D

V12FREQ	EQU $D46E
V12PULS	EQU $D470
V12CTRL	EQU $D472
V12AD	EQU $D473
V12SR	EQU $D474   

FILTCUT1 EQU $D415	
FILTRR1	 EQU $D417	
FMVOL1	 EQU $D418

FILTCUT2 EQU $D435	
FILTRR2	 EQU $D437	
FMVOL2	 EQU $D438

FILTCUT3 EQU $D455	
FILTRR3	 EQU $D457	
FMVOL3	 EQU $D458

FILTCUT4 EQU $D475	
FILTRR4	 EQU $D477	
FMVOL4	 EQU $D478

WAVETRI   EQU %00010000
WAVESAW   EQU %00100000
WAVEPULSE EQU %01000000
WAVENOISE EQU %10000000

FILTLOW	  EQU %00010000
FILTBAND  EQU %00100000
FILTHIGH  EQU %01000000

VOICE1WF   DC.B 0
VOICE2WF   DC.B 0
VOICE3WF   DC.B 0
VOICE4WF   DC.B 0
VOICE5WF   DC.B 0
VOICE6WF   DC.B 0
VOICE7WF   DC.B 0
VOICE8WF   DC.B 0
VOICE9WF   DC.B 0
VOICE10WF  DC.B 0
VOICE11WF  DC.B 0
VOICE12WF  DC.B 0

FILTRRSHAD1 DC.B 0
FMVOLSHAD1  DC.B 0
FILTRRSHAD2 DC.B 0
FMVOLSHAD2  DC.B 0
FILTRRSHAD3 DC.B 0
FMVOLSHAD3  DC.B 0
FILTRRSHAD4 DC.B 0
FMVOLSHAD4  DC.B 0

	MAC loadvoice
	ENDM

	MAC savevoice
	ENDM

	MAC voice_on
	lda VOICE{1}WF	
	ora #1
	sta VOICE{1}WF
	sta V{1}CTRL	
	ENDM
	
	MAC voice_off
	lda VOICE{1}WF		
	and #%11111110		
	sta V{1}CTRL	
	ENDM
	
	MAC voice_tone ; @pull
.REG EQU V{1}FREQ
	IF !FPULL
	pla
	sta .REG + 1	
	pla	
	sta .REG	
	ELSE	
	sta .REG	
	sty .REG + 1
	ENDIF	
	ENDM
	
	; e.g voice_wave 1,SAW
	; e.g voice_wave 2,PULSE
	MAC voice_wave
	lda VOICE{1}WF
	and %00001111
    ora #WAVE{2}
	sta VOICE{1}WF
	sta V{1}CTRL
	ENDM
	
	MAC voice_pulse ; @pull
.REG EQU V{1}PULS
	IF !FPULL
	pla
	sta .REG + 1	
	pla	
	sta .REG	
	ELSE	
	sta .REG	
	sty .REG + 1
	ENDIF	
	ENDM
	
	; Push order: A D S R
	MAC voice_adsr ; @pull
	IF !FPULL
	pla ; R
	ENDIF	
	sta R0	
	pla ; S	
	asl	
	asl	
	asl	
	asl	
	ora	R0
	sta V{1}SR
	pla ; D
	sta R0
	pla ; A
	asl	
	asl	
	asl	
	asl	
	ora	R0
	sta V{1}AD
	ENDM
	
	MAC voice_filteron
	lda #[1 << [{2} - 1]]
	ora FILTRRSHAD{1}
	sta FILTRRSHAD{1}
	sta FILTRR{1}
	ENDM
	
	MAC voice_filteroff
	lda #[[1 << [{2} - 1]] ^ $FF]
	and FILTRRSHAD{1}
	sta FILTRRSHAD{1}
	sta FILTRR{1}
	ENDM
	
	MAC filter
	lda FMVOLSHAD{1}
	and #%00001111
	ora #[{2}]
	sta FMVOLSHAD{1}
	sta FMVOL{1}
	ENDM
	
	MAC filter_cutoff ; @pull
	IF !FPULL
	pla
	sta R1	
	pla	
	sta R0
	ELSE	
	sta R0
	sty R1
	ENDIF
	and #%00000111
	sta FILTCUT{1}
	REPEAT 5
	asl R0
	rol R1
	REPEND
	lda R1
	sta FILTCUT{1} + 1
	ENDM
	
	MAC filter_resonance ; @pull
	IF !FPULL
	pla
	ENDIF
	asl
	asl
	asl
	asl
	sta R0
	lda FILTRRSHAD{1}
	and #%00001111
	ora R0
	sta FILTRRSHAD{1}
	sta FILTRR{1}
	ENDM
	
	MAC volume ; @pull
	IF !FPULL
	pla ; R
	ENDIF
	sta R0
	lda FMVOLSHAD{1}
	and #%11110000
	ora R0
	sta FMVOLSHAD{1}
	sta FMVOL{1}
	ENDM
	
	MAC sound_clear
	lda #0
	ldx #$78
.l1
	sta V1FREQ,x
	dex
	bpl .l1
    ldx #19
.l2
	sta VOICE1WF,x
	dex
	bpl .l2
	ENDM
	